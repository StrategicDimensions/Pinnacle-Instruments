<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2018 ForgeFlow, S.L. (https://www.forgeflow.com)
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>
    <template id="partner_statement.activity_statement_document">
        <t t-call="partner_statement.external_layout_DMX">
            <t t-set="o" t-value="o.with_context({'lang': lang})" />
            <div class="page">
                <h2 style="text-align:center;font-size:20px;">Activity Statement</h2>
                <div id="informations" class="row mt32 mb32">
                    <div class="col-3 bm-2">
                        <strong>Date:</strong>
                        <p t-esc="d['today']" class="m-0" />
                    </div>
                    <div t-if="o.ref" class="col-3 bm-2">
                        <strong>Partner Code:</strong>
                        <p t-field="o.ref" class="m-0" />
                    </div>
                </div>
                <t t-if="d['currencies']">
                    <br />
                    <t t-foreach="d['currencies'].items()" t-as="currency">
                        <t t-set="display_currency" t-value="Currencies[currency[0]]" />
                        <t t-set="currency" t-value="currency[1]" />
                        <p>
                                <span
                                t-if="account_type == 'payable'"
                            >Supplier </span>Statement between <span
                                t-esc="d['start']"
                            /> and <span t-esc="d['end']" /> in <span
                                t-esc="display_currency.name"
                            />
                            </p>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Reference number</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th class="amount">Amount</th>
                                    <th class="amount">Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td />
                                    <td>
                                        <span t-esc="d['start']" />
                                    </td>
                                    <td>
                                            Balance Forward
                                        </td>
                                    <td />
                                    <td class="amount">
                                        <span
                                            t-esc="currency['balance_forward']"
                                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                                        />
                                    </td>
                                </tr>
                                <tr
                                    t-foreach="currency['lines']"
                                    t-as="line"
                                    t-att-class="'statement-blocked' if line['blocked'] else ''">
                                    <td>
                                        <span t-esc="line['move_id']" />
                                    </td>
                                    <td>
                                        <span t-esc="line['date']" />
                                    </td>
                                    <td>
                                        <t t-if="line['name'] != '/'">
                                            <span t-esc="line['move_id']"/>
                                        </t>
                                        <t t-if="line['name'] == '/'">
                                            <span
                                                t-if="line['ref'] == 'Payment'"
                                            >Customer Payment</span>
                                            <span t-else="" t-esc="line['ref']" />
                                        </t>
                                    </td>
                                    <td class="amount">
                                        <span
                                            t-esc="line['amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                                        />
                                    </td>
                                    <td class="amount">
                                        <span
                                            t-esc="line['balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                                        />
                                    </td>
                                </tr>
                                <tr>
                                    <td />
                                    <td>
                                        <span t-esc="d['end']" />
                                    </td>
                                    <td>
                                            Ending Balance
                                        </td>
                                    <td />
                                    <td class="amount">
                                        <span
                                            t-esc="currency['amount_due']"
                                            t-options="{'widget': 'monetary', 'display_currency': display_currency}"
                                        />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <t
                            t-call="partner_statement.aging_buckets"
                            t-if="currency['buckets']"
                        />
                    </t>
                </t>
                <p t-if="d.get('no_entries')">
                    <strong>The partner doesn't have due entries.</strong>
                </p>
            </div>
        </t>
    </template>

    <template id="activity_statement">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="d" t-value="data.get(o.id)" />
                <t
                    t-call="partner_statement.activity_statement_document"
                />
            </t>
        </t>
    </template>

    <template id="external_layout_DMX">
            <div class="header" style="">
                <div class="row">
                    <center>
                        <img src="/dmx/static/src/img/Header.png" style="max-height: 150px; width: 100%"/>
                    </center>
                </div>

                <div class="row" style="margin-top:5px;">
                    <div class="col-xs-6">
                        <h4>
                            <span t-field="company.partner_id.name" style="font-weight: bold;"/>
                        </h4>
                        <t t-if="company.company_registry">
                            Company Reg. No
                            <span t-field="company.company_registry"/>
                        </t>
                        <t t-if="company.vat">
                            <t t-esc="company.country_id.vat_label or 'VAT No '"/>
                            <span t-field="company.vat"/>
                        </t><br/>
                        <span t-field='company.street'/>
                        <br/>
                        <span t-field='company.street2'/>
                        <br/>
                        <span t-field='company.city'/>
                        <span t-field='company.state_id.name'/>
                        <span t-field='company.zip'/>
                        <br/>
                        <span t-field='company.country_id.name'/>
                        <br/>
                    </div>
                    <div class="col-xs-2"/>
                    <div class="col-xs-4" style=" margin-left:15%;margin: left;height: 50%width: 38%;border: 2px solid black;padding: 10px;">
                        <span
                            t-esc="get_inv_addr(o)"
                            t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'
                        />
                        <div t-if="o.vat" class="mt16"><t
                                t-esc="company.country_id.vat_label or 'Tax ID'"
                            />: <span t-field="o.vat" /></div>
                    </div>
                </div>
            </div>

            <div class="article o_report_layout_standard">
                <t t-raw="0"/>
            </div>

            <div class="footer">
                <div class="text-center" style="border-top: 1px solid black;">
                    <ul class="list-inline mb4">
                        <li t-if="company.phone">Phone:
                            <span t-field="company.phone"/>
                        </li>
                        <li t-if="company.email">Email:
                            <span t-field="company.email"/>
                        </li>
                        <li t-if="company.website">Web:
                            <span t-field="company.website"/>
                        </li>
                    </ul>
                    <div name="financial_infos">
                        <span t-field="company.report_footer"/>
                    </div>
                    <div class="text-muted">
                        Page:
                        <span class="page"/>
                        /
                        <span class="topage"/>
                    </div>
                </div>

            </div>
        </template>

    <record id="partner_activity_statement" model='report.paperformat'>
        <field name="name">Partner Activity Statement</field>
        <field name="format">custom</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">90</field>
        <field name="header_spacing">85</field>
    </record>

    <record id="action_print_activity_statement" model="ir.actions.report">
            <field name="name">Activity Statement</field>
            <field name="model">res.partner</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">partner_statement.activity_statement</field>
            <field name="report_file">partner_statement.activity_statement</field>
            <field name="paperformat_id" ref="partner_statement.partner_activity_statement"/>
            <field name="binding_type">report</field>
        </record>
</odoo>
